classdef DynamicTableTest < tests.system.RoundTripTest & tests.system.AmendTest
    methods
        function addContainer(~, file)
            start_time = types.hdmf_common.VectorData(...
                'description', 'start_time',...
                'data', 1:100);
            stop_time = types.hdmf_common.VectorData(...
                'description', 'stop_time',...
                'data', 2:200);
            colnames = {'start_time', 'stop_time', 'randomvalues'};
            id = types.hdmf_common.ElementIdentifiers(...
                'data', 1:100);
            
            randcol = types.hdmf_common.VectorData(...
                'description', 'random data to be indexed into',...
                'data', rand(500,1));
            randidx = types.hdmf_common.VectorIndex(...
                'target', types.untyped.ObjectView('/intervals/trials/randomvalues'),...
                'data', 5:5:500 - 1);
            
            file.intervals_trials = types.core.TimeIntervals(...
                'description', 'test dynamic table columns',...
                'id', id,...
                'start_time', start_time,...
                'stop_time', stop_time,...
                'colnames', colnames,...
                'randomvalues', randcol,...
                'randomvalues_index', randidx);
        end
        
        function c = getContainer(~, file)
            c = file.intervals_trials.vectordata.get('randomvalues');
        end
        
        function appendContainer(testCase, file)
            container = testCase.getContainer(file);
            container.data = rand(500, 1); % new random values.
            file.intervals_trials.colnames{end+1} = 'newcolumn';
            file.intervals_trials.vectordata.set('newcolumn',...
                types.hdmf_common.VectorData(...
                'description', 'newly added column',...
                'data', 100:-1:1));
        end
    end
end

